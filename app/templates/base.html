<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>{% block title %}家庭资产盘存系统{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/styles.css?v=2.1">
    <link rel="stylesheet" href="/static/css/responsive.css?v=1.0">
    {% block extra_css %}{% endblock %}

    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">
                    <i data-lucide="home" style="width: 32px; height: 32px;"></i>
                    <span>家庭资产管理盘存系统</span>
                </a>
                <nav>
                    <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">
                        <i data-lucide="layout-dashboard" class="icon-sm"></i>
                        Dashboard
                    </a>
                    <a href="/inventory" class="nav-link {% if request.url.path == '/inventory' %}active{% endif %}">
                        <i data-lucide="package" class="icon-sm"></i>
                        Inventory
                    </a>
                    <a href="/import" class="nav-link {% if request.url.path == '/import' %}active{% endif %}">
                        <i data-lucide="download" class="icon-sm"></i>
                        Import
                    </a>
                    <a href="/alerts" class="nav-link {% if request.url.path == '/alerts' %}active{% endif %}">
                        <i data-lucide="bell" class="icon-sm"></i>
                        Alerts
                    </a>
                </nav>
                <div class="user-menu">
                    <div class="user-badge">
                        <i data-lucide="user" class="icon-sm"></i>
                        <span class="user-name">{{ user.username }}</span>
                        <span class="user-role badge-role-{{ user.role }}">{{ user.role }}</span>
                    </div>
                    <a href="/logout" class="btn-logout" title="Logout">
                        <i data-lucide="log-out" class="icon-sm"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <script>
        // Utility functions
        const API_BASE = '/api';

        async function fetchAPI(endpoint, options = {}) {
            const response = await fetch(`${API_BASE}${endpoint}`, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
        }

        function showMessage(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;

            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);

            setTimeout(() => alertDiv.remove(), 5000);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        function getExpiryBadge(expiryStatus) {
            const badges = {
                'fresh': 'badge-fresh',
                'expiring_soon': 'badge-expiring',
                'expired': 'badge-expired',
                'no_expiry': 'badge-no-expiry',
                'n/a': 'badge-secondary'
            };
            return badges[expiryStatus] || 'badge-secondary';
        }

        function getExpiryLabel(expiryStatus) {
            const labels = {
                'fresh': 'Fresh',
                'expiring_soon': 'Expiring Soon',
                'expired': 'Expired',
                'no_expiry': 'No Expiry',
                'n/a': 'N/A'
            };
            return labels[expiryStatus] || 'N/A';
        }
    </script>

    {% block extra_js %}{% endblock %}

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
