# 自动补全功能使用指南

## 功能介绍

系统新增了智能自动补全功能，可以在添加物品时为以下字段提供智能推荐：

- **类别（Category）**：如"食物"、"工具"、"厨具"等
- **位置路径（Location Path）**：如"冰箱 > 冷藏"、"厨房 > 冰箱上柜"等
- **单位（Unit）**：如"包"、"个"、"kg"等

推荐选项会根据您的使用频率自动排序，最常用的选项会显示在最前面。

---

## 首次使用设置

### 1. 初始化缓存

在首次使用前，需要运行一次初始化命令来从现有数据生成建议缓存：

**方式一：通过浏览器访问**
打开浏览器访问：
```
http://localhost:8000/api/autocomplete/initialize
```

**方式二：通过命令行**
```bash
curl -X POST http://localhost:8000/api/autocomplete/initialize
```

看到以下响应表示初始化成功：
```json
{
    "success": true,
    "counts": {
        "category": 30,
        "location_path": 13,
        "unit": 20
    },
    "message": "Cache initialized successfully"
}
```

---

## 如何使用

### 1. 打开"添加物品"表单

在库存页面点击"添加物品"按钮。

### 2. 输入时自动显示建议

当您在以下字段中输入时，会自动弹出建议菜单：

#### **类别字段**
- 点击输入框或开始输入，会显示最常用的类别
- 继续输入可以过滤建议列表
- 每个建议旁边的数字代表使用次数

#### **位置路径字段**
- 显示您最常用的位置路径
- 支持层级路径，如"冰箱 > 冷藏"

#### **单位字段**
- 显示最常用的单位
- 支持中文单位（包、个、件）和英文单位（count、kg、liter）

### 3. 选择建议

**方式一：鼠标操作**
- 将鼠标悬停在建议上会高亮显示
- 点击建议即可选中

**方式二：键盘操作**
- 按 **↓**（下箭头）选择下一个建议
- 按 **↑**（上箭头）选择上一个建议
- 按 **Enter**（回车）确认选中
- 按 **Esc**（退出键）关闭建议菜单

### 4. 手动输入

如果建议列表中没有您想要的选项，也可以直接手动输入新的值。系统会在您保存后自动记录该值，下次使用时会出现在建议列表中。

---

## 建议排序规则

建议按以下规则排序：

1. **使用频率**（从高到低）
2. **最后使用时间**（最近使用的排在前面）

这意味着：
- 您使用次数越多的选项，排名越靠前
- 如果两个选项使用次数相同，最近使用的会排在前面

---

## 示例场景

### 场景1：添加食品类物品

1. 打开"添加物品"表单
2. 在**类别**字段中，点击输入框
3. 看到建议列表：
   ```
   食物 (72次)
   食品 (28次)
   厨具 (17次)
   工具 (14次)
   ```
4. 点击"食物"或按↓键选中后按Enter

### 场景2：选择存放位置

1. 在**位置路径**字段中，点击输入框
2. 看到建议列表：
   ```
   冰箱 > 冷藏 (44次)
   厨房墙挂储物柜 (27次)
   厨房 > 冰箱上柜（1号柜）(22次)
   ```
3. 选择"冰箱 > 冷藏"

### 场景3：自定义新值

1. 在**单位**字段中输入"袋"
2. 保存物品
3. 下次再添加物品时，"袋"会出现在建议列表中

---

## 查看使用统计

如果您想查看当前缓存的统计信息，可以访问：

```
http://localhost:8000/api/autocomplete/statistics
```

会显示：
- 总缓存条目数
- 每个字段类型的条目数和总使用频率
- 最常用的前20个值

---

## 常见问题

### Q：为什么我的新输入值没有出现在建议中？
**A：** 确保您已经保存了物品。系统只会在成功创建物品后记录使用频率。

### Q：如何删除不想要的建议？
**A：** 系统会自动清理使用频率低于2次的条目。您也可以手动清理：
```bash
curl -X POST http://localhost:8000/api/autocomplete/cleanup
```

### Q：建议列表太长了，能减少吗？
**A：** 默认最多显示10个建议。如果您想调整，可以在代码中修改 `maxSuggestions` 参数。

### Q：能否关闭某个字段的自动补全？
**A：** 可以。如果您不需要某个字段的自动补全，仍然可以直接手动输入，不受影响。

---

## 技术支持

如果您在使用过程中遇到问题，请：
1. 查看浏览器控制台是否有错误信息
2. 检查服务器日志
3. 提交Issue到项目仓库

---

**祝您使用愉快！** 🎉
